# 典型73 木DP

https://atcoder.jp/contests/typical90/tasks/typical90_bu
https://twitter.com/e869120/status/1407109731546636289
https://twitter.com/e869120/status/1407510677934149635

解説の漸化式がわかりにくかったのでメモ

## 基本アイデア

与えられた木を根付き木と見て，各部分木内で許される辺の取り除き方の総数を考える．
ある頂点を根とする部分木内の辺の取り除き方は，その頂点の直接の子を根とした部分木に対して求めた値を用いて計算できる．

## DPテーブルの設計

dp&#91;k&#93;&#91;v&#93;: vを根とした部分木に対する辺の取り除き方のうち，辺を取り除いたあとに残るvと連結な成分が
  1. 'a'のみを含むもの (k=0)
  2. 'b'のみを含むもの (k=1)
  3. 'a'と'b'をともに含むもの

vを含まない連結成分は，すべて'a'と'b'を含むようにする．

## DPテーブルの更新

ある頂点vに書かれている文字が'a'のときを考える．('b'のときは，適切に役割を入れ替えることで同様に漸化式をつくれる)

まず，dp&#91;0&#93;&#91;v&#93;，つまりvを含む連結成分が'a'のみを含む場合を考える．
子の頂点を$\{b_1,...,b_k\}$とするとき，ひとつの子$b_i$に注目すると，$v$と$b_i$を結ぶ辺を残す場合には$b_i$を含む連結成分は'a'だけを含むように切る必要があるから，$dp[0][b_i]$通り．
$v$と$b_i$を結ぶ辺を除く場合には$b_i$を含む連結成分は'a'と'b'の両方を含むように切る必要があるから，$dp[2][b_i]$通り．
それぞれの子に対する辺の除き方はどのような組み合わせで選んでもよいから，

$$ dp[0][v] = \prod_i (dp[0][b_i] + dp[2][b_i]) $$

次に，$dp[2][v]$，つまりvを含む連結成分が'a','b'両方を含むように辺を取り除く方法を考える．
いきなり求めるのは難しいので，実際には許されない辺の除き方も含めて多めに数えたあと，実際には条件を満たさないぶんを引くという方法で考える．
まず，子$b_i$に注目すると，$b_i$との間の辺を残す場合には$b_i$と連結な成分は任意で良いと考える．つまり，$dp[0][b_i] + dp[1][b_i] + dp[2][b_i]$を数える．$b_i$との間の辺を除く場合には，$b_i$を含む連結成分は'a','b'の両方を含まなければならないから，$dp[2][b_i]$通り．
それぞれの子についての辺の除き方の組み合わせを考えると，

$$ \prod_i (dp[0][b_i] + dp[1][b_i] + 2dp[2][b_i]) $$

ただし，これだと$v$を含む連結成分が'a'のみしか含まない場合が含まれている．
したがって，

$$ dp[2][v] = (\prod_i (dp[0][b_i] + dp[1][b_i] + 2dp[2][b_i])) - dp[0][v] $$
